@import helper._
@import window._
@import service.ProductionService.ProductionInfoData
@(title: String, clazz: String, form: Form[ProductionInfoData], formCall: Call)(implicit request: RequestHeader, messages: Messages)

@windowBase(title, "main-window", clazz){
<ul>
    <li class="window-menu-content">@Html(Messages("window.menu.file"))</li>
    <li class="window-menu-content">@Html(Messages("window.menu.edit"))</li>
    <li class="window-menu-content">@Html(Messages("window.menu.search"))</li>
    <li class="window-menu-content">@Html(Messages("window.menu.help"))</li>
</ul>
} {
    @helper.form(
        action = formCall,
        Symbol("enctype") -> "multipart/form-data",
        Symbol("id") -> s"manage-production-form-${form("id").value.fold("new")(id => id)}",
        Symbol("data-window-id") -> clazz
    ) {
        @CSRF.formField
        <input type="hidden" name="id" value="@form("id").value">
        @helper.inputText(form("title"))
        <input type="file" name="thumbnail_image">
        <input type="hidden" name="thumbnail" value="@form("thumbnail").value">
        <textarea class="production-content" name="content" value="@form("content").value"></textarea>
        <input type="submit">
    }
    <script>
        $(document).ready(function() {
            var thisContent = $('#@clazz .production-content');
            thisContent.trumbowyg({
                btnsDef: {
                    image: {
                        dropdown: ['insertImage', 'upload'],
                        ico: 'insertImage'
                    }
                },
                btns: [
                    ['viewHTML'],
                    ['formatting'],
                    ['fontfamily', 'fontsize'],
                    ['strong', 'em', 'del'],
                    ['superscript', 'subscript'],
                    ['link'],
                    ['image'],
                    ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
                    ['unorderedList', 'orderedList'],
                    ['table'], ['tableCellBackgroundColor', 'tableBorderColor'],
                    ['horizontalRule'],
                    ['removeformat'],
                    ['fullscreen']
                ],
                imageWidthModalEdit: true,
                tagClasses: {
                    table: 'table table-bordered'
                },
                plugins: {
                    upload: {
                        serverPath: "@helper.CSRF(routes.Images.upload()).url",
                        fileFieldName: 'image',
                        success: function (data, trumbowyg, $modal, values) {
                            var editor = $('#@clazz .production-content');
                            editor.trumbowyg('html', editor.trumbowyg('html') + '<img src="' + data.file + '" alt="' + values.alt + '" width="' + values.width + '">');
                            editor.trumbowyg('closeModal');
                        },
                        error: function() {
                            console.log("test");
                        },
                        imageWidthModalEdit: true
                    },
                    resizimg: {
                        minSize: 64,
                        step: 16,
                    }
                }
            });
            thisContent.trumbowyg('html', thisContent.attr('value'));
        });
    </script>
}